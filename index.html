<!DOCTYPE html>
<html lang="lb">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>P3 – Auer: Üben & Spiller</title>
<style>
  @font-face{
    font-family:'Schoulschrëft';
    src:url('https://raw.githubusercontent.com/albrechtclaire1007/schoulschreft/main/schoulschreft_bold%5B2%5D.TTF') format('truetype');
    font-weight:bold; font-display:swap;
  }

  :root{
    --red:#f1583f;      /* hour + pivot ring */
    --blue:#75b7cb;     /* minute + accents */
    --blue-soft:#e5f3f6;
    --face:url('https://i.postimg.cc/6qC1Vnjg/temp-Imagel6-ZZRm.avif');
    --btn-r:18px;
  }

  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; background:#fffef8; color:#111;
    font-family:'Schoulschrëft', Arial, sans-serif; display:flex; flex-direction:column;
  }

  /* tabs */
  .topbar{display:flex;justify-content:center;gap:12px;padding:14px 12px;background:var(--blue-soft);border-bottom:4px solid var(--blue);}
  .tab{background:#fff;border:3px solid var(--blue);border-radius:999px;padding:8px 16px;font-size:20px;cursor:pointer;font-family:'Schoulschrëft',Arial,sans-serif;}
  .tab.active{background:#f7fcfd}

  .section{display:none;padding:18px 12px 30px;}
  .section.active{display:block}
  .center{text-align:center}
  .chip{display:inline-block;padding:8px 14px;border-radius:16px;border:3px solid var(--blue);background:#fff;font-size:28px;}
  .btn{font-family:'Schoulschrëft',Arial,sans-serif;border:3px solid var(--blue);background:#fff;border-radius:var(--btn-r);padding:10px 20px;font-size:22px;cursor:pointer;}
  .mt8{margin-top:8px}.mt12{margin-top:12px}.mt16{margin-top:16px}

  /* clock with background image */
  .clock-wrap{display:flex;flex-direction:column;align-items:center;}
  .clock{
    position:relative;width:360px;height:360px;
    background:#fff center/contain no-repeat;background-image:var(--face);
    border-radius:50%;margin:16px auto;box-shadow:0 6px 18px rgba(0,0,0,.06);touch-action:none;
  }

  /* invisible tick markers (for flashing on success) */
  .tick{position:absolute;width:44px;height:44px;transform:translate(-50%,-50%);border-radius:50%;pointer-events:none;}
  .flash-green{animation:greenflash 900ms ease-in-out 1;}
  @keyframes greenflash{
    0%{box-shadow:0 0 0 0 rgba(0,160,0,0);background:transparent;}
    25%{box-shadow:0 0 0 6px rgba(0,160,0,.15);background:rgba(0,200,0,.08);}
    55%{box-shadow:0 0 0 10px rgba(0,160,0,.22);background:rgba(0,200,0,.12);}
    100%{box-shadow:0 0 0 0 rgba(0,160,0,0);background:transparent;}
  }

  /* hands (hour above minute; pivot above both) */
  .hand{position:absolute;left:50%;top:50%;transform-origin:50% 100%;border-radius:6px;touch-action:none;cursor:grab;z-index:1;}
  .min{  width:6px;height:150px;background:var(--blue);transform:translate(-50%,-100%) rotate(0deg);z-index:2;}
  .hour{ width:8px;height:110px;background:var(--red); transform:translate(-50%,-100%) rotate(0deg);z-index:3;}
  .ghost{opacity:.6}
  .pivot{position:absolute;left:50%;top:50%;width:18px;height:18px;background:#fff;border:4px solid var(--red);border-radius:50%;transform:translate(-50%,-50%);z-index:4;}

  .readout{font-size:26px;min-height:32px}

  @media (max-width:480px){
    .clock{width:300px;height:300px}
    .hour{height:92px}.min{height:128px}
    .tick{width:36px;height:36px}
    .chip{font-size:24px}.btn{font-size:20px}
  }
</style>
</head>
<body>

<div class="topbar">
  <button class="tab active" data-target="aueren">Auer üben</button>
  <button class="tab" data-target="spill1">1. Spill – Hallwer</button>
  <button class="tab" data-target="spill2">2. Spill – D’Zäit astellen</button>
</div>

<!-- Auer üben -->
<section id="aueren" class="section active">
  <div class="center">
    <div class="chip">Probéier e puer Auerzäiten aus</div>
    <div class="mt12">
      <label style="font-size:20px">
        <input type="checkbox" id="toggleDigital" checked>
        Digital Auer uweisen
      </label>
    </div>
  </div>
  <div class="clock-wrap mt16">
    <div id="c1" class="clock"></div>
    <div id="c1readout" class="readout center">12:00</div>
  </div>
</section>

<!-- 1. Spill – Hallwer -->
<section id="spill1" class="section">
  <div class="center">
    <div class="chip">Beweeg <b>de Minuttenzär</b> bis bei déi nächst voll Stonn</div>
  </div>
  <div class="clock-wrap mt16">
    <div id="c2" class="clock"></div>
    <div class="center mt12">
      <button class="btn" id="nextHallwer">Nächst Beispill</button>
    </div>
    <div id="hFeedback" class="readout center"></div>
  </div>
</section>

<!-- 2. Spill – D’Zäit astellen -->
<section id="spill2" class="section">
  <div class="center">
    <div id="pPrompt" class="chip">Et ass zéng Auer</div>
    <div class="mt12"><button class="btn" id="pListen">Lauschteren</button></div>
  </div>
  <div class="clock-wrap mt16">
    <div id="c3" class="clock"></div>
    <div class="center mt12"><button class="btn" id="pValidate">Validéieren</button></div>
    <div id="pFeedback" class="readout center"></div>
  </div>
</section>

<script>
/* ---------- shared helpers ---------- */
function setHand(el,deg){ el.style.transform=`translate(-50%,-100%) rotate(${deg}deg)`; el.dataset.deg=deg }
function degFromPointer(e, clockEl){
  const r=clockEl.getBoundingClientRect();
  const cx=r.left+r.width/2, cy=r.top+r.height/2;
  const px=(e.touches?e.touches[0].clientX:e.clientX);
  const py=(e.touches?e.touches[0].clientY:e.clientY);
  let d=Math.atan2(py-cy, px-cx)*180/Math.PI + 90;
  if(d<0) d+=360;
  return d;
}
function placeTicks(clockEl){
  clockEl.querySelectorAll('.tick').forEach(t=>t.remove());
  const rect=clockEl.getBoundingClientRect();
  const radius = rect.width/2 - 24;  /* nudge this if you change the face image */
  const cx=rect.width/2, cy=rect.height/2;
  for(let n=1;n<=12;n++){
    const ang=(n-3)*(Math.PI*2)/12;
    const x=cx + radius*Math.cos(ang);
    const y=cy + radius*Math.sin(ang);
    const t=document.createElement('div');
    t.className='tick'; t.dataset.n=n;
    t.style.left=x+'px'; t.style.top=y+'px';
    clockEl.appendChild(t);
  }
}

/* ---------- Auer üben (coupled clock) ---------- */
function coupledClock(rootId, readoutId, showDigital=true){
  const root=document.getElementById(rootId);
  placeTicks(root);
  const hour=document.createElement('div'); hour.className='hand hour';
  const min =document.createElement('div'); min.className='hand min';
  const pivot=document.createElement('div'); pivot.className='pivot';
  root.append(hour,min,pivot);
  window.addEventListener('resize', ()=>placeTicks(root));

  let H=12, M=0;
  const ro=document.getElementById(readoutId);

  function normalize(){ while(M<0){M+=60;H--} while(M>=60){M-=60;H++} while(H<=0){H+=12} while(H>12){H-=12} }
  function render(){ setHand(min,M*6); setHand(hour,(H%12)*30 + M*0.5); if(ro) ro.textContent = showDigital ? `${String(((H%12)||12)).padStart(2,'0')}:${String(M).padStart(2,'0')}` : ''; }
  function setTime(h,m){ H=h; M=m; normalize(); render(); }

  function drag(el, mode){
    let on=false;
    const start=e=>{ if(e.target!==el) return; on=true; e.preventDefault(); }
    const move =e=>{
      if(!on) return;
      const d=degFromPointer(e, root);
      if(mode==='min'){
        const prev=M*6;
        const delta=(((d - prev + 540) % 360) - 180);
        const dm=Math.round(delta/6);
        setTime(H, M+dm);
      }else{
        let total=d/30; if(total<0) total+=12;
        let base=Math.floor(total)||12;
        let mins=Math.round((total - Math.floor(total))*60);
        if(mins===60){ mins=0; base=(base%12)+1; }
        setTime(base, mins);
      }
    };
    const end=()=>{ on=false; };
    el.addEventListener('mousedown',start);
    window.addEventListener('mousemove',move);
    window.addEventListener('mouseup',end);
    el.addEventListener('touchstart',start,{passive:false});
    window.addEventListener('touchmove',move,{passive:false});
    window.addEventListener('touchend',end);
  }
  drag(min,'min'); drag(hour,'hour');

  setTime(10,10);
  return { setTime };
}

/* mount simple clock */
const simple = coupledClock('c1','c1readout', true);
document.getElementById('toggleDigital').addEventListener('change', e=>{
  document.getElementById('c1readout').style.display = e.target.checked ? 'block' : 'none';
});

/* ---------- 1. Spill – Hallwer (manual next) ---------- */
(function(){
  const root=document.getElementById('c2');
  placeTicks(root);

  const hSolid=document.createElement('div'); hSolid.className='hand hour';
  const mSolid=document.createElement('div'); mSolid.className='hand min';
  const hGhost=document.createElement('div'); hGhost.className='hand hour ghost';
  const mGhost=document.createElement('div'); mGhost.className='hand min ghost';
  const pivot=document.createElement('div'); pivot.className='pivot';
  root.append(hSolid,mSolid,hGhost,mGhost,pivot);
  window.addEventListener('resize', ()=>placeTicks(root));

  const fb=document.getElementById('hFeedback');
  const nextBtn=document.getElementById('nextHallwer');

  let X=3; // start hour for X:30

  function setStart(x){
    // solid reference at x:30
    setHand(mSolid, 180);
    setHand(hSolid, (x%12)*30 + 15);
    // draggable ghosts start same
    setHand(mGhost, 180);
    setHand(hGhost, (x%12)*30 + 15);
    fb.textContent = "";
  }
  function newRound(){ X = Math.floor(Math.random()*12)+1; setStart(X); }
  nextBtn.addEventListener('click', newRound);

  // couple ghost hour based on ghost minute
  function coupleGhostByMinute(deg){
    setHand(mGhost, deg);
    const mm = Math.round(((deg%360)+360)%360 / 6);     // 0..59
    const forward = ((mm + 60) - 30) % 60;              // from :30 moving forward
    const hourFrac = X + 0.5 + forward/60;              // toward next hour
    const hDeg = (hourFrac % 12) * 30;
    setHand(hGhost, hDeg);
    return { mm, hDeg };
  }

  // drag minute ghost
  (function(){
    let on=false;
    const start=e=>{ if(e.target!==mGhost) return; on=true; e.preventDefault(); }
    const move =e=>{ if(!on) return; const d=degFromPointer(e, root); coupleGhostByMinute(d); };
    const end  =()=>{ on=false; };
    mGhost.addEventListener('mousedown',start);
    window.addEventListener('mousemove',move);
    window.addEventListener('mouseup',end);
    mGhost.addEventListener('touchstart',start,{passive:false});
    window.addEventListener('touchmove',move,{passive:false});
    window.addEventListener('touchend',end);
  })();

  // continuous success check (no auto-next)
  function check(){
    const mDeg = parseFloat(mGhost.dataset.deg||'0');
    const mm   = Math.round(((mDeg%360)+360)%360 / 6) % 60;
    const atTop = (mm<=3 || mm>=57);                   // around 12
    const next = (X % 12) + 1;
    const hDeg = parseFloat(hGhost.dataset.deg||'0');
    const targetH = (next%12)*30;
    const diff = Math.abs((((hDeg - targetH) + 540) % 360) - 180);
    const hourOK = diff <= 6;

    if(atTop && hourOK){
      fb.textContent = `Richteg! Et ass hallwer ${next}.`;
      const tick = [...root.querySelectorAll('.tick')].find(t => Number(t.dataset.n) === (next===13?1:next));
      if(tick){ tick.classList.remove('flash-green'); void tick.offsetWidth; tick.classList.add('flash-green'); }
    }
    requestAnimationFrame(check);
  }

  newRound();
  requestAnimationFrame(check);
})();

/* ---------- 2. Spill – D’Zäit astellen (auto-advance on correct) ---------- */
(function(){
  const items = [
    { label:"Et ass zéng Auer",         h:10, m:0,  audio:"audio/p3_zeng_auer.mp3" },
    { label:"Et ass hallwer zwielef",   h:11, m:30, audio:"audio/p3_hallwer_zwielef.mp3" },
    { label:"Et ass néng Auer",         h:9,  m:0,  audio:"audio/p3_neng_auer.mp3" },
    { label:"Et ass hallwer siwen",     h:6,  m:30, audio:"audio/p3_hallwer_siwen.mp3" },
    { label:"Et ass aacht Auer",        h:8,  m:0,  audio:"audio/p3_aacht_auer.mp3" },
    { label:"Et ass hallwer dräi",      h:2,  m:30, audio:"audio/p3_hallwer_draei.mp3" },
    { label:"Et ass zwielef Auer",      h:12, m:0,  audio:"audio/p3_zwielef_auer.mp3" },
    { label:"Et ass hallwer néng",      h:8,  m:30, audio:"audio/p3_hallwer_neng.mp3" },
    { label:"Et ass dräi Auer",         h:3,  m:0,  audio:"audio/p3_draei_auer.mp3" },
    { label:"Et ass hallwer aacht",     h:7,  m:30, audio:"audio/p3_hallwer_aacht.mp3" },
    { label:"Et ass fënnef Auer",       h:5,  m:0,  audio:"audio/p3_fennef_auer.mp3" },
    { label:"Et ass hallwer zéng",      h:9,  m:30, audio:"audio/p3_hallwer_zeng.mp3" },
    { label:"Et ass sechs Auer",        h:6,  m:0,  audio:"audio/p3_sechs_auer.mp3" },
    { label:"Et ass hallwer fënnef",    h:4,  m:30, audio:"audio/p3_hallwer_fennef.mp3" },
    { label:"Et ass eng Auer",          h:1,  m:0,  audio:"audio/p3_eng_auer.mp3" }
  ];
  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}
  shuffle(items);
  let idx=0;

  const root=document.getElementById('c3');
  placeTicks(root);
  const hour=document.createElement('div'); hour.className='hand hour';
  const min =document.createElement('div'); min.className='hand min';
  const pivot=document.createElement('div'); pivot.className='pivot';
  root.append(hour,min,pivot);
  window.addEventListener('resize', ()=>placeTicks(root));

  const promptEl=document.getElementById('pPrompt');
  const fb=document.getElementById('pFeedback');
  const audio=new Audio();

  function load(i){
    const it=items[i];
    promptEl.textContent = it.label;
    setHand(min,0); setHand(hour,0);
    min.dataset.target = (it.m*6);
    hour.dataset.target = ((it.h%12)*30 + it.m*0.5);
    audio.src = it.audio;
    fb.textContent = '';
  }
  function smallest(a,b){ let d=Math.abs(a-b)%360; return d>180?360-d:d }
  const MIN_TOL=9, HOUR_TOL=7;

  function drag(el){
    let on=false;
    const start=e=>{ if(e.target!==el) return; on=true; e.preventDefault(); }
    const move=e=>{ if(!on) return; const d=degFromPointer(e, root); setHand(el,d); }
    const end =()=>{ on=false; };
    el.addEventListener('mousedown',start);
    window.addEventListener('mousemove',move);
    window.addEventListener('mouseup',end);
    el.addEventListener('touchstart',start,{passive:false});
    window.addEventListener('touchmove',move,{passive:false});
    window.addEventListener('touchend',end);
  }
  drag(min); drag(hour);

  document.getElementById('pListen').addEventListener('click', ()=>audio.play());
  document.getElementById('pValidate').addEventListener('click', ()=>{
    const mDeg=parseFloat(min.dataset.deg||0), hDeg=parseFloat(hour.dataset.deg||0);
    const mt=parseFloat(min.dataset.target), ht=parseFloat(hour.dataset.target);
    const okM = smallest(mDeg, mt) <= MIN_TOL;
    const okH = smallest(hDeg, ht) <= HOUR_TOL;
    fb.textContent = (okM && okH) ? 'Richteg!' : 'Nach eng Kéier!';
    if(okM && okH){ setTimeout(()=>{ idx=(idx+1)%items.length; load(idx); }, 800); }
  });

  load(idx);
})();

/* tabs */
document.querySelectorAll('.tab').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    document.getElementById(btn.dataset.target).classList.add('active');
  });
});
</script>
</body>
</html>


